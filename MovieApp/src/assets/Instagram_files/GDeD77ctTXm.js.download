;/*FB_PKG_DELIM*/

__d("LSOptimisticUpdateThreadDisappearingSetting",["LSIssueNewError","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return c.sb(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=!1:(b=a.item,d[0]=b.errorShouldBeShown)})},function(a){return d[0]===!0?c.seq([function(a){return c.localizeV2Async(c.i64.cast([0,2285622730]),f).then(function(a){return d[4]=a})},function(a){return c.localizeV2Async(c.i64.cast([0,1919524925]),f).then(function(a){return d[5]=a})},function(a){return c.sp(b("LSIssueNewError"),f,c.i64.cast([0,1545093]),d[4],d[5],f,f)}]):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("wa_jid",f),d[2].set("thread_key",a[0]),d[2].set("disappearing_ttl",a[1]),d[2].set("updated_timestamp",a[2]),d[2].set("updated_by",a[3]),d[2].set("sync_group",c.i64.cast([0,95])),d[3]=c.toJSON(d[2]),c.sp(b("LSIssueNewTask"),"disappearing_setting",c.i64.cast([0,714]),d[3],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSOptimisticUpdateThreadDisappearingSettingStoredProcedure",["LSOptimisticUpdateThreadDisappearingSetting"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.threadKey;d[1]=b.disappearingTtl;d[2]=b.updatedTimestamp;d[3]=b.updatedBy;return c("LSOptimisticUpdateThreadDisappearingSetting").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MAWEphemeralSettingsUpdate",["FBLogger","I64","LSOptimisticUpdateThreadDisappearingSettingStoredProcedure","MAWChatJid","MAWCurrentUser","Promise","WAJids","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWEphemeralSettingsUpdate"),k=c("requireDeferred")("LSFactory").__setRef("MAWEphemeralSettingsUpdate");function l(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield a.table("threads").get(e));if(a!=null){e=a.disappearingSettingUpdatedTs;a=a.disappearingSettingTtl;if(e==null||a==null)return!0;if((i||(i=d("I64"))).lt(e,(i||(i=d("I64"))).of_int32(c))&&!(i||(i=d("I64"))).equal(a,(i||(i=d("I64"))).of_int32(b)))return!0}return!1});return m.apply(this,arguments)}function n(a,b,c,d,e,f){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,m){var n=(yield l(a,e,f,g));if(!n)return(h||(h=b("Promise"))).resolve();j&&c("FBLogger")("labyrinth_web").addMetadata("LABYRINTH_WEB","APP_VERSION","OCCAM_EPHEMERAL_SETTINGS_UPDATE").info("[Occam][Web] Ephemeral Settings Updated.");n=(yield k.load());return c("LSOptimisticUpdateThreadDisappearingSettingStoredProcedure")(n(a),{disappearingTtl:(i||(i=d("I64"))).of_int32(e),threadKey:g,updatedBy:i.of_string((j=m)!=null?j:d("MAWCurrentUser").getID()),updatedTimestamp:i.of_int32(f)})});return o.apply(this,arguments)}function a(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=(yield j.load());d=(yield d());return d.runInTransaction(function(d){return n(d,a,b,c,!1)},"readwrite")});return p.apply(this,arguments)}function e(a,b,c,d){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=(yield j.load());g=(yield g());return g.runInTransaction(function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(g){var i=(yield d("MAWChatJid").toThreadKeyMaybe(g,d("WAJids").threadIdForChatJid(e)));return i!=null?n(g,a,c,i,f):(h||(h=b("Promise"))).resolve()});return function(a){return g.apply(this,arguments)}}(),"readwrite")});return q.apply(this,arguments)}g.updateEphemeralSettingsWithTxn=n;g.updateEphemeralSettings=a;g.updateEphemeralSettingsByChatJid=e}),98);